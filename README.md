# RometeControl

## 1设计要求

在局域网内实现一台主机（server）控制另外一台主机（client）

## 2方案设计

开发环境：windows 10 64位

开发工具：Qt 5.7.0  winGW 32 位

在控制之前，控制端和被控制先实现一个信息的换，被控制端指定控制通道的端口和数据通道的端口，控制接受放回的信息，之后打开通道实现与被控制端的交互。

双通道TCP来实现控制端和被控制端的交互。控制通道：被控制的主机作为一个server ， 不断接收来控制端的控制信号。数据通道：主机不断发送实时桌面的信息图片。

## 3总体方案的选择和设计

###（1）控制端和被控制端通过IP和确认口令来实现对接

​			控制端发送char passwd[50] 以内的认证口令给被控制端。如果口令正确，被控制端就打开TCP双通道，等待控制命令的传达，对控制命令

###（2）对被控制主机的实现（此部分实现基于开源代码）

#### i. 发送控制信息信息

所有的信号使用一个uchar uc[8]来表示，其中uc[0]表示控制端有如下操作，剩下7位对于各个操作的有不同的定义

1. 鼠标移动、鼠标双击、鼠标左键按下、鼠标左键释放、鼠标右键释放、鼠标右键按下

这几个控制信号都只使用uc[1]~uc[4]，分别代表如下：
uc[1]表示当前鼠标坐标x/0x100
uc[2]表示当前鼠标坐标x%0x100
uc[3]表示当前鼠标坐标y/0x100
uc[4]表示当前鼠标坐标y%0x100

2. 键盘按键按下、键盘按键释放
这两个信号之使用uc[1]来表示按下或者释放的按键

3. 鼠标滚轮
使用uc[1]~uc[6]
uc[1]表示鼠标滚轮划过的距离/0x100
uc[2]表示鼠标滚轮划过的距离%0x100
uc[3]表示当前鼠标坐标x/0x100
uc[4]表示当前鼠标坐标x%0x100
uc[5]表示当前鼠标坐标y/0x100
uc[6]表示当前鼠标坐标y%0x100

#### ii. 调用 Windows API

被控制端接受信息之后，调用Windows提供的API模拟控制端的操作

###（3）图像数据的传输

​		每个500ms，被控制主机向控制机发送一帧。前四个字节为所发送图	像的尺寸， 从低字节到高字节依次为width_high, width_low, height_high, 	height_low ， 后面为图像数据，每个像素3个字节，依次为RGB通道。

## 4 可以改进的地方

​	图片传输的效率十分低，控制端开始的时候可以收到反馈的图片时间会更久，我觉得可以通过一些手段，比如图片压缩的方法来达到提高提高传送效率。

## 5 总结

​	通过这次实验，实际的体验TCP运输层和应用层的关系。

参考资料

 

[1] CSDN博客：http://blog.csdn.net/tobacco5648/article/details/24817081.

[2]霍亚飞、程梁  《Qt5 编程入门》，2015 

[3]陆文周 《Qt5 开发及其实例》，2015